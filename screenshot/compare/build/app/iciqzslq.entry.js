/*! Built with http://stenciljs.com */
const{h:t}=window.App;import{a as i,b as e,c as a}from"./chunk-adc0ad6b.js";class s{constructor(){this.mismatchedPixels=null,this.mismatchedRatio=null}navToId(t){t.preventDefault(),t.stopPropagation(),i({diff:this.diffId})}render(){return[t("p",{class:"test-path"},this.testPath),t("dl",null,t("div",null,t("dt",null,"Diff"),t("dd",null,t("a",{href:"#diff-"+this.diffId,onClick:this.navToId.bind(this)},this.diffId))),t("div",null,t("dt",null,"Mismatched Pixels"),t("dd",null,"number"==typeof this.mismatchedPixels?this.mismatchedPixels:"--")),t("div",null,t("dt",null,"Mismatched Ratio"),t("dd",null,"number"==typeof this.mismatchedRatio?this.mismatchedRatio.toFixed(4):"--")),t("div",null,t("dt",null,"Device"),t("dd",null,this.device)),t("div",null,t("dt",null,"Width"),t("dd",null,this.width)),t("div",null,t("dt",null,"Height"),t("dd",null,this.height)),t("div",null,t("dt",null,"Device Scale Factor"),t("dd",null,this.deviceScaleFactor)),t("div",{class:"desc"},t("dt",null,"Description"),t("dd",null,this.desc)))]}static get is(){return"compare-analysis"}static get encapsulation(){return"shadow"}static get properties(){return{desc:{type:String,attr:"desc"},device:{type:String,attr:"device"},deviceScaleFactor:{type:Number,attr:"device-scale-factor"},diffId:{type:String,attr:"diff-id"},height:{type:Number,attr:"height"},mismatchedPixels:{type:Number,attr:"mismatched-pixels"},mismatchedRatio:{type:Number,attr:"mismatched-ratio"},testPath:{type:String,attr:"test-path"},width:{type:Number,attr:"width"}}}static get style(){return".test-path{margin-top:0;padding-top:0;font-size:10px;color:var(--analysis-data-color)}dl{padding:0;margin:0;font-size:var(--analysis-data-font-size);line-height:28px}div{display:-webkit-box;display:-ms-flexbox;display:flex;width:240px}dt{display:inline;-webkit-box-flex:2;-ms-flex:2;flex:2;font-weight:500}dd{display:inline;-webkit-box-flex:1;-ms-flex:1;flex:1;color:var(--analysis-data-color)}.desc,.desc dt{display:block}.desc dd{display:block;margin:0}p{padding-top:14px;font-size:var(--analysis-data-font-size)}a{color:var(--analysis-data-color)}a:hover{text-decoration:none}"}}var d=function(t,i,e,a,s,d){d||(d={});for(var r=void 0===d.threshold?.1:d.threshold,c=35215*r*r,f=0,u=0;u<s;u++)for(var g=0;g<a;g++){var p=4*(u*a+g);if(l(t,i,p,p)>c)d.includeAA||!h(t,g,u,a,s,i)&&!h(i,g,u,a,s,t)?(e&&o(e,p,255,0,0),f++):e&&o(e,p,255,255,0);else if(e){var v=m(n(m((y=t)[(w=p)+0],I=y[w+3]/255),m(y[w+1],I),m(y[w+2],I)),.1);o(e,p,v,v,v)}}var y,w,I;return f};function h(t,i,e,a,s,d){for(var n,r,c,m,o=Math.max(i-1,0),f=Math.max(e-1,0),u=Math.min(i+1,a-1),g=Math.min(e+1,s-1),p=4*(e*a+i),v=0,y=0,w=0,I=0,b=0,x=o;x<=u;x++)for(var P=f;P<=g;P++)if(x!==i||P!==e){var A=l(t,t,p,4*(P*a+x),!0);if(0===A?v++:A<0?w++:A>0&&y++,v>2)return!1;d&&(A<I&&(I=A,n=x,r=P),A>b&&(b=A,c=x,m=P))}return!d||0!==w&&0!==y&&(!h(t,n,r,a,s)&&!h(d,n,r,a,s)||!h(t,c,m,a,s)&&!h(d,c,m,a,s))}function l(t,i,e,a,s){var d=t[e+3]/255,h=i[a+3]/255,l=m(t[e+0],d),o=m(t[e+1],d),f=m(t[e+2],d),u=m(i[a+0],h),g=m(i[a+1],h),p=m(i[a+2],h),v=n(l,o,f)-n(u,g,p);if(s)return v;var y=r(l,o,f)-r(u,g,p),w=c(l,o,f)-c(u,g,p);return.5053*v*v+.299*y*y+.1957*w*w}function n(t,i,e){return.29889531*t+.58662247*i+.11448223*e}function r(t,i,e){return.59597799*t-.2741761*i-.32180189*e}function c(t,i,e){return.21147017*t-.52261711*i+.31114694*e}function m(t,i){return 255+(t-255)*i}function o(t,i,e,a,s){t[i+0]=e,t[i+1]=a,t[i+2]=s,t[i+3]=255}function f(t,i,e){if(g.has(t))return void e(g.get(t));if(u.has(t))return void u.get(t).push(e);u.set(t,[e]);const a=document.createElement("script");a.src=i,document.head.appendChild(a)}window.loadScreenshot=((t,i)=>{const e=u.get(t);e&&(e.forEach(t=>t(i)),u.delete(t)),g.set(t,i)});const u=new Map,g=new Map;class p{constructor(){this.mismatchedPixels=null,this.isComparable=!1,this.imagesLoaded=new Set,this.isImageALoaded=!1,this.isImageBLoaded=!1,this.isCanvasLoaded=!1,this.initialized=!1,this.isComparing=!1,this.mismatchedRatio=null,this.hasRendered=!1}componentWillLoad(){this.mismatchedPixels=this.diff.mismatchedPixels,this.mismatchedRatio=this.diff.mismatchedRatio,this.isComparable=null!=this.diff.imageA&&null!=this.diff.imageB,this.device=this.diff.device}runCompare(){this.diff.identical||this.initialized||(this.initialized=!0,window.requestIdleCallback?window.requestIdleCallback(this.loadImages.bind(this)):window.requestAnimationFrame(this.loadImages.bind(this)))}loadImages(){null!=this.diff.imageA&&f(this.diff.imageA,this.diff.jsonpUrlA,t=>{this.imageA.src=t,this.imageA.style.visibility="",this.isImageALoaded=!0}),null!=this.diff.imageB&&f(this.diff.imageB,this.diff.jsonpUrlB,t=>{this.imageB.src=t,this.imageB.style.visibility="",this.isImageBLoaded=!0})}async compareImages(){const t=this.diff;this.isImageALoaded&&this.isImageBLoaded&&!this.isComparing&&!this.isCanvasLoaded&&(this.isComparing=!0,this.mismatchedPixels=await function(t,i,e,a,s){const h=document.createElement("canvas");h.width=a,h.height=s;const l=document.createElement("canvas");l.width=a,l.height=s;const n=h.getContext("2d");n.drawImage(t,0,0);const r=l.getContext("2d");r.drawImage(i,0,0);const c=document.createElement("canvas").getContext("2d");c.drawImage(t,0,0),c.getImageData(0,0,a,s);const m=n.getImageData(0,0,a,s).data,o=r.getImageData(0,0,a,s).data,f=e.getContext("2d"),u=f.createImageData(a,h.height),g=d(m,o,u.data,a,s,{threshold:.1});return f.putImageData(u,0,0),g}(this.imageA,this.imageB,this.canvas,t.naturalWidth,t.naturalHeight),this.canvas.style.visibility="",this.isCanvasLoaded=!0,this.mismatchedRatio=t.mismatchedPixels/(t.naturalWidth*t.naturalHeight),this.analysis&&(this.analysis.mismatchedPixels=this.mismatchedPixels,this.analysis.mismatchedRatio=this.mismatchedRatio),e(t.imageA,t.imageB,t.mismatchedPixels),a())}render(){if(this.hasRendered)return;this.hasRendered=!0;const i=this.diff,e={width:i.width+"px",height:i.height+"px",visibility:this.diff.identical?"":"hidden"};return[t("compare-cell",null,t("img",{src:this.diff.identical?this.imagesUrl+i.imageA:"",style:e,onLoad:this.diff.identical?null:this.compareImages.bind(this),ref:t=>this.imageA=t})),t("compare-cell",null,t("img",{src:this.diff.identical?this.imagesUrl+i.imageA:"",style:e,onLoad:this.diff.identical?null:this.compareImages.bind(this),ref:t=>this.imageB=t})),t("compare-cell",null,this.diff.identical?t("img",{style:e,src:this.imagesUrl+i.imageA}):t("canvas",{width:i.naturalWidth,height:i.naturalHeight,style:e,ref:t=>this.canvas=t})),t("compare-cell",null,t("compare-analysis",{diffId:this.diff.id,mismatchedPixels:this.mismatchedPixels,mismatchedRatio:this.mismatchedRatio,device:this.diff.device,width:this.diff.width,height:this.diff.height,deviceScaleFactor:this.diff.deviceScaleFactor,desc:this.diff.desc,testPath:this.diff.testPath,ref:t=>this.analysis=t}))]}static get is(){return"compare-row"}static get properties(){return{device:{type:String,attr:"device",mutable:!0},diff:{type:"Any",attr:"diff"},elm:{elementRef:!0},imagesUrl:{type:String,attr:"images-url"},isComparable:{type:Boolean,attr:"is-comparable",mutable:!0},mismatchedPixels:{type:Number,attr:"mismatched-pixels",mutable:!0},runCompare:{method:!0}}}static get style(){return"compare-row canvas,compare-row img{-webkit-box-shadow:var(--screenshot-box-shadow);box-shadow:var(--screenshot-box-shadow);border-radius:var(--screenshot-border-radius)}"}}export{s as CompareAnalysis,p as CompareRow};