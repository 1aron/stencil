/*! Built with http://stenciljs.com */
var __awaiter=this&&this.__awaiter||function(e,t,i,a){return new(i||(i=Promise))(function(r,n){function s(e){try{l(a.next(e))}catch(e){n(e)}}function o(e){try{l(a.throw(e))}catch(e){n(e)}}function l(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(s,o)}l((a=a.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var i,a,r,n,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function o(n){return function(o){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,a&&(r=2&n[0]?a.return:n[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,n[1])).done)return r;switch(a=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,a=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){s.label=n[1];break}if(6===n[0]&&s.label<r[1]){s.label=r[1],r=n;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(n);break}r[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],a=0}finally{i=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,o])}}};App.loadBundle("b7qfinrk",["exports"],function(e){var t=window.App.h,i=function(){function e(){this.mismatchedPixels=null}return e.prototype.navToDiff=function(e){e.preventDefault(),e.stopPropagation(),this.diffNavChange.emit(this.diff.id)},e.prototype.render=function(){var e=this.diff,i="number"==typeof this.mismatchedPixels,a=i?this.mismatchedPixels/(e.width*e.deviceScaleFactor*(e.height*e.deviceScaleFactor)):null,r="";return i?this.mismatchedPixels>0&&(r="has-mismatch"):r="not-calculated",[t("p",{class:"test-path"},e.testPath),t("dl",null,t("div",null,t("dt",null,"Diff"),t("dd",null,t("a",{href:"#diff-"+e.id,onClick:this.navToDiff.bind(this)},e.id))),t("div",{class:r},t("dt",null,"Mismatched Pixels"),t("dd",null,i?this.mismatchedPixels:"--")),t("div",{class:r},t("dt",null,"Mismatched Ratio"),t("dd",null,i?a.toFixed(4):"--")),t("div",null,t("dt",null,"Device"),t("dd",null,e.device)),t("div",null,t("dt",null,"Width"),t("dd",null,e.width)),t("div",null,t("dt",null,"Height"),t("dd",null,e.height)),t("div",null,t("dt",null,"Device Scale Factor"),t("dd",null,e.deviceScaleFactor)),t("div",{class:"desc"},t("dt",null,"Description"),t("dd",null,e.desc)))]},Object.defineProperty(e,"is",{get:function(){return"compare-analysis"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{diff:{type:"Any",attr:"diff"},mismatchedPixels:{type:Number,attr:"mismatched-pixels"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"events",{get:function(){return[{name:"diffNavChange",method:"diffNavChange",bubbles:!0,cancelable:!0,composed:!0}]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return".test-path.sc-compare-analysis{margin-top:0;padding-top:0;font-size:10px;color:var(--analysis-data-color)}dl.sc-compare-analysis{padding:0;margin:0;font-size:var(--analysis-data-font-size);line-height:28px}div.sc-compare-analysis{display:-webkit-box;display:-ms-flexbox;display:flex;width:260px}dt.sc-compare-analysis{display:inline;-webkit-box-flex:2;-ms-flex:2;flex:2;font-weight:500}dd.sc-compare-analysis{display:inline;-webkit-box-flex:1;-ms-flex:1;flex:1;color:var(--analysis-data-color)}.desc.sc-compare-analysis, .desc.sc-compare-analysis   dt.sc-compare-analysis{display:block}.desc.sc-compare-analysis   dd.sc-compare-analysis{display:block;margin:0;line-height:22px}.not-calculated.sc-compare-analysis   dd.sc-compare-analysis{color:#ccc}.has-mismatch.sc-compare-analysis   dd.sc-compare-analysis{color:#ff6200}p.sc-compare-analysis{padding-top:14px;font-size:var(--analysis-data-font-size)}a.sc-compare-analysis{color:var(--analysis-data-color)}a.sc-compare-analysis:hover{text-decoration:none}"},enumerable:!0,configurable:!0}),e}();function a(e,t){return"screenshot_mismatch_"+e+"_"+t}function r(e,t,i,a,s,o){for(var l,c,d,h,u=Math.max(t-1,0),f=Math.max(i-1,0),m=Math.min(t+1,a-1),p=Math.min(i+1,s-1),g=4*(i*a+t),v=0,b=0,y=0,w=0,P=0,S=u;S<=m;S++)for(var A=f;A<=p;A++)if(S!==t||A!==i){var x=n(e,e,g,4*(A*a+S),!0);if(0===x?v++:x<0?y++:x>0&&b++,v>2)return!1;o&&(x<w&&(w=x,l=S,c=A),x>P&&(P=x,d=S,h=A))}return!o||0!==y&&0!==b&&(!r(e,l,c,a,s)&&!r(o,l,c,a,s)||!r(e,d,h,a,s)&&!r(o,d,h,a,s))}function n(e,t,i,a,r){var n=e[i+3]/255,d=t[a+3]/255,h=c(e[i+0],n),u=c(e[i+1],n),f=c(e[i+2],n),m=c(t[a+0],d),p=c(t[a+1],d),g=c(t[a+2],d),v=s(h,u,f)-s(m,p,g);if(r)return v;var b=o(h,u,f)-o(m,p,g),y=l(h,u,f)-l(m,p,g);return.5053*v*v+.299*b*b+.1957*y*y}function s(e,t,i){return.29889531*e+.58662247*t+.11448223*i}function o(e,t,i){return.59597799*e-.2741761*t-.32180189*i}function l(e,t,i){return.21147017*e-.52261711*t+.31114694*i}function c(e,t){return 255+(e-255)*t}function d(e,t,i,a,r){e[t+0]=i,e[t+1]=a,e[t+2]=r,e[t+3]=255}function h(e,t,i){if(f.has(t))i(f.get(t));else if(u.has(t))u.get(t).push(i);else{u.set(t,[i]);var a=document.createElement("script");a.src=e+"screenshot_"+t+".js",document.head.appendChild(a)}}window.loadScreenshot=function(e,t){var i=u.get(e);i&&(i.forEach(function(e){return e(t)}),u.delete(e)),f.set(e,t)};var u=new Map,f=new Map,m=function(){function e(){this.imageASrc="",this.imageBSrc="",this.imagesLoaded=new Set,this.isImageALoaded=!1,this.isImageBLoaded=!1,this.initializeCalculateMismatch=!1,this.hasCalculatedMismatch=!1}return e.prototype.componentWillLoad=function(){this.loadScreenshots()},e.prototype.componentWillUpdate=function(){this.loadScreenshots()},e.prototype.loadScreenshots=function(){var e=this;if(this.show)return this.diff.identical?(this.imageASrc=this.imagesUrl+this.diff.imageA,void(this.imageBSrc=this.imagesUrl+this.diff.imageB)):void(this.initializeCalculateMismatch||(this.imageAClass="is-loading",this.imageBClass="is-loading",this.canvasClass="is-loading",this.initializeCalculateMismatch=!0,null!=this.jsonpUrl?(null!=this.diff.imageA&&h(this.jsonpUrl,this.diff.imageA,function(t){e.imageASrc=t}),null!=this.diff.imageB&&h(this.jsonpUrl,this.diff.imageB,function(t){e.imageBSrc=t})):(this.imageASrc=this.imagesUrl+this.diff.imageA,this.imageBSrc=this.imagesUrl+this.diff.imageB)))},e.prototype.compareImages=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return e=this.diff,this.isImageALoaded&&this.isImageBLoaded&&!this.hasCalculatedMismatch?(this.hasCalculatedMismatch=!0,t=e,[4,function(e,t,i,a,o){var l=-1;try{var h=document.createElement("canvas");h.width=a,h.height=o;var u=document.createElement("canvas");u.width=a,u.height=o;var f=h.getContext("2d");f.drawImage(e,0,0);var m=u.getContext("2d");m.drawImage(t,0,0);var p=document.createElement("canvas").getContext("2d");p.drawImage(e,0,0),p.getImageData(0,0,a,o);var g=f.getImageData(0,0,a,o).data,v=m.getImageData(0,0,a,o).data,b=i.getContext("2d"),y=b.createImageData(a,h.height);l=function(e,t,i,a,o,l){l||(l={});for(var h=void 0===l.threshold?.1:l.threshold,u=35215*h*h,f=0,m=0;m<o;m++)for(var p=0;p<a;p++){var g=4*(m*a+p);if(n(e,t,g,g)>u)l.includeAA||!r(e,p,m,a,o,t)&&!r(t,p,m,a,o,e)?(i&&d(i,g,255,0,0),f++):i&&d(i,g,255,255,0);else if(i){var v=c(s(c((b=e)[(y=g)+0],w=b[y+3]/255),c(b[y+1],w),c(b[y+2],w)),.1);d(i,g,v,v,v)}}var b,y,w;return f}(g,v,y.data,a,o,{threshold:.1}),b.putImageData(y,0,0)}catch(e){console.error(e)}return l}(this.imageA,this.imageB,this.canvas,Math.round(e.width*e.deviceScaleFactor),Math.round(e.height*e.deviceScaleFactor))]):[2];case 1:return t.mismatchedPixels=i.sent(),this.canvasClass="has-loaded",o=e.mismatchedPixels,l=a(e.imageA,e.imageB),localStorage.setItem(l,String(o)),this.compareLoaded.emit(e),[2]}var o,l})})},e.prototype.render=function(){var e=this,i=this.diff,a={width:i.width+"px",height:i.height+"px"};return[t("compare-cell",null,t("a",{href:this.imagesUrl+i.imageA,target:"_blank"},t("img",{src:this.imageASrc,class:this.imageAClass,style:a,onLoad:this.diff.identical?null:function(){e.isImageALoaded=!0,e.imageAClass="has-loaded",e.compareImages()},ref:function(t){return e.imageA=t}}))),t("compare-cell",null,t("a",{href:this.imagesUrl+i.imageA,target:"_blank"},t("img",{src:this.imageBSrc,class:this.imageBClass,style:a,onLoad:this.diff.identical?null:function(){e.isImageBLoaded=!0,e.imageBClass="has-loaded",e.compareImages()},ref:function(t){return e.imageB=t}}))),t("compare-cell",null,this.diff.identical?t("img",{style:a,src:this.imageASrc}):t("canvas",{width:Math.round(i.width*i.deviceScaleFactor),height:Math.round(i.height*i.deviceScaleFactor),class:this.canvasClass,style:a,ref:function(t){return e.canvas=t}})),t("compare-cell",null,t("compare-analysis",{mismatchedPixels:this.diff.mismatchedPixels,diff:this.diff}))]},Object.defineProperty(e,"is",{get:function(){return"compare-row"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{canvasClass:{state:!0},diff:{type:"Any",attr:"diff"},elm:{elementRef:!0},imageAClass:{state:!0},imageASrc:{state:!0},imageBClass:{state:!0},imageBSrc:{state:!0},imagesUrl:{type:String,attr:"images-url"},jsonpUrl:{type:String,attr:"jsonp-url"},show:{type:Boolean,attr:"show"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"events",{get:function(){return[{name:"compareLoaded",method:"compareLoaded",bubbles:!0,cancelable:!0,composed:!0}]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return"compare-row canvas,compare-row img{-webkit-box-shadow:var(--screenshot-box-shadow);box-shadow:var(--screenshot-box-shadow);border-radius:var(--screenshot-border-radius)}.is-loading{visibility:hidden}"},enumerable:!0,configurable:!0}),e}(),p=function(){function e(){}return e.prototype.render=function(){if(this.a&&this.b&&this.diffs){var e=0;this.diffs.forEach(function(t){t.width>e&&(e=t.width)});var i={width:(e-=6)+"px"};return[t("th-cell",null,t("div",{style:i},t("a",{href:this.a.url},this.a.message))),t("th-cell",null,t("div",{style:i},t("a",{href:this.b.url},this.b.message))),t("th-cell",null,t("div",{style:i},"Diff")),t("th-cell",{class:"analysis"},t("div",null,"Analysis"))]}},Object.defineProperty(e,"is",{get:function(){return"compare-thead"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{a:{type:"Any",attr:"a"},b:{type:"Any",attr:"b"},diffs:{type:"Any",attr:"diffs"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return".sc-compare-thead-h{display:-webkit-box;display:-ms-flexbox;display:flex}th-cell.sc-compare-thead{display:block;-webkit-box-flex:1;-ms-flex:1;flex:1;font-weight:500;font-size:12px}th-cell.sc-compare-thead   div.sc-compare-thead{padding-left:12px;padding-right:12px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}th-cell.sc-compare-thead   a.sc-compare-thead{color:var(--font-color);text-decoration:none}th-cell.sc-compare-thead   a.sc-compare-thead:hover{color:var(--analysis-data-color);text-decoration:underline}.analysis.sc-compare-thead   div.sc-compare-thead{width:262px}"},enumerable:!0,configurable:!0}),e}();function g(e,t){var i=Object.assign({},e,t),a=Object.keys(i),r=[];return a.map(function(e){var t=i[e];!0===t?r.push(e):null!=t&&""!==t&&r.push(e+"-"+t)}),window.location.hash=r.sort().join(";"),i}var v=function(){function e(){this.appSrcUrl="",this.imagesUrl="/data/images/",this.buildsUrl="/data/builds/",this.comparesUrl="/data/compares/",this.jsonpUrl=null,this.diffs=[]}return e.prototype.componentWillLoad=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.compare?(this.diffs=b(this.compare,this.imagesUrl),this.a=this.compare.a,this.b=this.compare.b,[3,3]):[3,1];case 1:return this.match&&this.match.params.buildIdA&&this.match.params.buildIdB?[4,this.loadBuilds(this.match.params.buildIdA,this.match.params.buildIdB)]:[3,3];case 2:e.sent(),e.label=3;case 3:return this.filter=(t={},""!==(i=location.hash.replace("#",""))&&i.split(";").forEach(function(e){var i=e.split("-");t[i[0]]=!(i.length>1)||i[1]}),t),this.updateDiffs(),[2]}var t,i})})},e.prototype.componentDidLoad=function(){this.filter&&this.filter.diff&&this.navToDiff(this.filter.diff)},e.prototype.loadBuilds=function(e,t){return __awaiter(this,void 0,void 0,function(){var i,r,n,s,o,l,c,d,h,u,f;return __generator(this,function(m){switch(m.label){case 0:return i=""+this.comparesUrl+e+"-"+t+".json",r=""+this.buildsUrl+e+".json","master"===e&&(r+="?ts="+Date.now()),n=""+this.buildsUrl+t+".json","master"===t&&(n+="?ts="+Date.now()),[4,Promise.all([fetch(i),fetch(r),fetch(n)])];case 1:return[4,(s=m.sent())[0]];case 2:return o=m.sent(),[4,s[1]];case 3:return l=m.sent(),[4,s[2]];case 4:return c=m.sent(),o.ok?[4,o.json()]:[3,6];case 5:return d=m.sent(),this.diffs=b(d,this.imagesUrl),this.a=d.a,this.b=d.b,[3,10];case 6:return l.ok&&c.ok?(h=this,[4,l.json()]):[3,10];case 7:return h.a=m.sent(),u=this,[4,c.json()];case 8:return u.b=m.sent(),f=this,[4,(p=this.imagesUrl,g=this.a,v=this.b,y=[],g.screenshots.forEach(function(e){var t=v.screenshots.find(function(t){return t.id===e.id});if(t){var i=e.image===t.image,r={id:e.id,desc:e.desc,testPath:e.testPath,imageA:e.image,imageUrlA:""+p+e.image,imageB:t.image,imageUrlB:""+p+t.image,identical:i,mismatchedPixels:i?0:null,width:e.width,height:e.height,deviceScaleFactor:e.deviceScaleFactor,device:e.device||e.userAgent,show:!1};if(!i){var n=function(e,t){var i=a(r.imageA,r.imageB),n=localStorage.getItem(i);if("string"==typeof n){var s=parseInt(n,10);if(!isNaN(s))return s}return null}();"number"==typeof n&&(r.mismatchedPixels=n,0===r.mismatchedPixels&&(r.identical=!0))}y.push(r)}}),y)];case 9:f.diffs=m.sent(),m.label=10;case 10:return[2]}var p,g,v,y})})},e.prototype.filterChange=function(e){this.filter=g(this.filter,e.detail),this.updateDiffs()},e.prototype.diffNavChange=function(e){var t=e.detail;this.filter=g(this.filter,{diff:t}),this.updateDiffs(),this.navToDiff(t)},e.prototype.navToDiff=function(e){var t=document.getElementById("d-"+e),i=document.querySelector(".scroll-y");t&&i&&(i.scrollTop=t.offsetTop-84)},e.prototype.compareLoaded=function(e){var t=e.detail,i=this.diffs.find(function(e){return e.id===t.id});i&&(i.mismatchedPixels=t.mismatchedPixels),this.updateDiffs()},e.prototype.updateDiffs=function(){var e;this.diffs=(e=this.filter,this.diffs.map(function(t){return t=Object.assign({},t),function(e,t){var i=!e.device||e.device===t.device,a=!e.search||t.desc.includes(e.search),r=!0;return e.diff&&e.diff===t.id?r=!0:e.mismatch?null!=t.mismatchedPixels&&"all"!==e.mismatch&&(r=parseInt(e.mismatch,10)<t.mismatchedPixels):r=t.mismatchedPixels>0||null==t.mismatchedPixels,t.show=i&&a&&r,t}(e,t)}).sort(function(e,t){return e.mismatchedPixels>t.mismatchedPixels?-1:e.mismatchedPixels<t.mismatchedPixels?1:e.desc.toLowerCase()<t.desc.toLowerCase()?-1:e.desc.toLowerCase()>t.desc.toLowerCase()?1:e.device.toLowerCase()<t.device.toLowerCase()?-1:e.device.toLowerCase()>t.device.toLowerCase()?1:0}))},e.prototype.render=function(){var e=this;return[t("compare-header",{diffs:this.diffs,filter:this.filter,appSrcUrl:this.appSrcUrl}),t("section",{class:"scroll-x"},t("compare-thead",{a:this.a,b:this.b,diffs:this.diffs}),t("section",{class:"scroll-y"},t("compare-table",null,t("compare-tbody",null,this.diffs.map(function(i){return t("compare-row",{key:i.id,id:"d-"+i.id,show:i.show,hidden:!i.show,imagesUrl:e.imagesUrl,jsonpUrl:e.jsonpUrl,diff:i})})))))]},Object.defineProperty(e,"is",{get:function(){return"screenshot-compare"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{appSrcUrl:{type:String,attr:"app-src-url"},buildsUrl:{type:String,attr:"builds-url"},compare:{type:"Any",attr:"compare"},comparesUrl:{type:String,attr:"compares-url"},diffs:{state:!0},filter:{state:!0},imagesUrl:{type:String,attr:"images-url"},jsonpUrl:{type:String,attr:"jsonp-url"},match:{type:"Any",attr:"match"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"listeners",{get:function(){return[{name:"filterChange",method:"filterChange"},{name:"diffNavChange",method:"diffNavChange"},{name:"compareLoaded",method:"compareLoaded"}]},enumerable:!0,configurable:!0}),e}();function b(e,t){return e.diffs.map(function(e){return{id:e.id,desc:e.desc,testPath:e.testPath,imageA:e.imageA,imageUrlA:""+t+e.imageA,imageB:e.imageB,imageUrlB:""+t+e.imageB,identical:0===e.mismatchedPixels,mismatchedPixels:e.mismatchedPixels,width:e.width,height:e.height,deviceScaleFactor:e.deviceScaleFactor,device:e.device||e.userAgent,show:!1}})}e.CompareAnalysis=i,e.CompareRow=m,e.CompareThead=p,e.ScreenshotCompare=v,Object.defineProperty(e,"__esModule",{value:!0})});