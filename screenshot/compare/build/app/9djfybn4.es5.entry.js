/*! Built with http://stenciljs.com */
var __awaiter=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(a,n){function l(e){try{o(r.next(e))}catch(e){n(e)}}function s(e){try{o(r.throw(e))}catch(e){n(e)}}function o(e){e.done?a(e.value):new i(function(t){t(e.value)}).then(l,s)}o((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var i,r,a,n,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,r&&(a=2&n[0]?r.return:n[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,r=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(!(a=(a=l.trys).length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){l.label=n[1];break}if(6===n[0]&&l.label<a[1]){l.label=a[1],a=n;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(n);break}a[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],r=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}};App.loadBundle("9djfybn4",["exports"],function(e){var t=window.App.h,i=function(){function e(){}return e.prototype.navToId=function(e){e.preventDefault(),e.stopPropagation()},e.prototype.render=function(){var e=this.diff,i="number"==typeof e.mismatchedPixels,r=i?e.mismatchedPixels/(e.width*e.deviceScaleFactor*(e.height*e.deviceScaleFactor)):null,a="";return i?e.mismatchedPixels>0&&(a="has-mismatch"):a="not-calculated",[t("p",{class:"test-path"},e.testPath),t("dl",null,t("div",null,t("dt",null,"Diff"),t("dd",null,t("a",{href:"#diff-"+e.id,onClick:this.navToId.bind(this)},e.id))),t("div",{class:a},t("dt",null,"Mismatched Pixels"),t("dd",null,i?e.mismatchedPixels:"--")),t("div",{class:a},t("dt",null,"Mismatched Ratio"),t("dd",null,i?r.toFixed(4):"--")),t("div",null,t("dt",null,"Device"),t("dd",null,e.device)),t("div",null,t("dt",null,"Width"),t("dd",null,e.width)),t("div",null,t("dt",null,"Height"),t("dd",null,e.height)),t("div",null,t("dt",null,"Device Scale Factor"),t("dd",null,e.deviceScaleFactor)),t("div",{class:"desc"},t("dt",null,"Description"),t("dd",null,e.desc)))]},Object.defineProperty(e,"is",{get:function(){return"compare-analysis"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{diff:{type:"Any",attr:"diff"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return".test-path{margin-top:0;padding-top:0;font-size:10px;color:var(--analysis-data-color)}dl{padding:0;margin:0;font-size:var(--analysis-data-font-size);line-height:28px}div{display:-webkit-box;display:-ms-flexbox;display:flex;width:260px}dt{display:inline;-webkit-box-flex:2;-ms-flex:2;flex:2;font-weight:500}dd{display:inline;-webkit-box-flex:1;-ms-flex:1;flex:1;color:var(--analysis-data-color)}.desc,.desc dt{display:block}.desc dd{display:block;margin:0;line-height:22px}.not-calculated dd{color:#ccc}.has-mismatch dd{color:#ff6200}p{padding-top:14px;font-size:var(--analysis-data-font-size)}a{color:var(--analysis-data-color)}a:hover{text-decoration:none}"},enumerable:!0,configurable:!0}),e}(),r=function(){function e(){}return e.prototype.render=function(){var e=this,i=this.diffs.reduce(function(e,t){return e.some(function(e){return e.value===t.device})||e.push({text:t.device,value:t.device}),e},[{text:"All Devices",value:""}]);return t("section",null,t("div",{class:"showing"},"Showing ",this.diffs.filter(function(e){return!e.hidden}).length),t("div",{class:"search"},t("input",{type:"search",onInput:function(t){e.filterChange.emit({search:t.target.value})},value:this.filter.search||""})),i.length>1?t("div",{class:"device"},t("select",{onInput:function(t){e.filterChange.emit({device:t.target.value})}},i.map(function(i){return t("option",{key:i.value,selected:i.value===e.filter.device,value:i.value},i.text)}))):null,t("div",{class:"mismatch"},t("select",{onInput:function(t){e.filterChange.emit({mismatch:t.target.value})}},t("option",{value:"",selected:""===this.filter.mismatch},"> 0"),t("option",{value:"100",selected:"100"===this.filter.mismatch},"> 100"),t("option",{value:"250",selected:"250"===this.filter.mismatch},"> 250"),t("option",{value:"500",selected:"500"===this.filter.mismatch},"> 500"),t("option",{value:"1000",selected:"1000"===this.filter.mismatch},"> 1,000"),t("option",{value:"2500",selected:"2500"===this.filter.mismatch},"> 2,500"),t("option",{value:"5000",selected:"5000"===this.filter.mismatch},"> 5,000"),t("option",{value:"10000",selected:"10000"===this.filter.mismatch},"> 10,000"),t("option",{value:"all",selected:"all"===this.filter.mismatch},"All Screenshots"))))},Object.defineProperty(e,"is",{get:function(){return"compare-filter"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{diffs:{type:"Any",attr:"diffs"},filter:{type:"Any",attr:"filter"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"events",{get:function(){return[{name:"filterChange",method:"filterChange",bubbles:!0,cancelable:!0,composed:!0}]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return"input,select{font-size:10px}.showing{font-size:12px;white-space:nowrap;margin:17px 8px 0 0;color:var(--analysis-data-color)}section{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end}.device,.mismatch,.search{margin:13px 8px 0 0}"},enumerable:!0,configurable:!0}),e}(),a=function(){function e(){this.repo=null}return e.prototype.logoClick=function(e){e.preventDefault(),e.stopPropagation(),document.querySelector(".scroll-y").scrollTop=0},e.prototype.render=function(){return[this.repo?t("nav",{class:"breadcrumbs"},t("a",{href:this.repo.orgUrl},this.repo.orgUrl),t("a",{href:this.repo.repoUrl},this.repo.repoName),t("a",{href:this.repo.commitsUrl},"commits")):null,t("header",null,t("div",{class:"logo"},t("a",{href:"#",onClick:this.logoClick.bind(this)},t("img",{src:this.appSrcUrl+"/assets/logo.png"}))),t("compare-filter",{diffs:this.diffs,filter:this.filter}))]},Object.defineProperty(e,"is",{get:function(){return"compare-header"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{appSrcUrl:{type:String,attr:"app-src-url"},diffs:{type:"Any",attr:"diffs"},filter:{type:"Any",attr:"filter"},repo:{type:"Any",attr:"repo"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return":host{background:#fff;-webkit-box-shadow:var(--header-box-shadow);box-shadow:var(--header-box-shadow)}nav{padding:4px}nav a{font-size:14px;text-decoration:none;color:var(--breadcrumb-color);display:inline-block;padding:0 4px}nav a:hover{text-decoration:underline}header{display:-webkit-box;display:-ms-flexbox;display:flex;width:calc(100% - 115px);padding:8px}img{width:174px;height:32px}.logo{-webkit-box-flex:1;-ms-flex:1;flex:1;padding:7px}compare-filter{-webkit-box-flex:1;-ms-flex:1;flex:1}h1{margin:0;padding:0;font-size:18px}"},enumerable:!0,configurable:!0}),e}();function n(e,t){return"screenshot_mismatch_"+e+"_"+t}function l(e,t,i,r,a,n){for(var o,c,d,u,h=Math.max(t-1,0),f=Math.max(i-1,0),m=Math.min(t+1,r-1),p=Math.min(i+1,a-1),g=4*(i*r+t),v=0,b=0,y=0,w=0,P=0,A=h;A<=m;A++)for(var C=f;C<=p;C++)if(A!==t||C!==i){var S=s(e,e,g,4*(C*r+A),!0);if(0===S?v++:S<0?y++:S>0&&b++,v>2)return!1;n&&(S<w&&(w=S,o=A,c=C),S>P&&(P=S,d=A,u=C))}return!n||0!==y&&0!==b&&(!l(e,o,c,r,a)&&!l(n,o,c,r,a)||!l(e,d,u,r,a)&&!l(n,d,u,r,a))}function s(e,t,i,r,a){var n=e[i+3]/255,l=t[r+3]/255,s=u(e[i+0],n),h=u(e[i+1],n),f=u(e[i+2],n),m=u(t[r+0],l),p=u(t[r+1],l),g=u(t[r+2],l),v=o(s,h,f)-o(m,p,g);if(a)return v;var b=c(s,h,f)-c(m,p,g),y=d(s,h,f)-d(m,p,g);return.5053*v*v+.299*b*b+.1957*y*y}function o(e,t,i){return.29889531*e+.58662247*t+.11448223*i}function c(e,t,i){return.59597799*e-.2741761*t-.32180189*i}function d(e,t,i){return.21147017*e-.52261711*t+.31114694*i}function u(e,t){return 255+(e-255)*t}function h(e,t,i,r,a){e[t+0]=i,e[t+1]=r,e[t+2]=a,e[t+3]=255}function f(e,t,i){if(p.has(e))i(p.get(e));else if(m.has(e))m.get(e).push(i);else{m.set(e,[i]);var r=document.createElement("script");r.src=t,document.head.appendChild(r)}}window.loadScreenshot=function(e,t){var i=m.get(e);i&&(i.forEach(function(e){return e(t)}),m.delete(e)),p.set(e,t)};var m=new Map,p=new Map,g=function(){function e(){this.imageASrc="",this.imageBSrc="",this.imagesLoaded=new Set,this.isImageALoaded=!1,this.isImageBLoaded=!1,this.initializeCalculateMismatch=!1,this.hasCalculatedMismatch=!1}return e.prototype.componentWillLoad=function(){this.loadScreenshots()},e.prototype.componentWillUpdate=function(){this.loadScreenshots()},e.prototype.loadScreenshots=function(){var e=this;if(!this.hidden)return this.diff.identical?(this.imageASrc=this.imagesUrl+this.diff.imageA,void(this.imageBSrc=this.imagesUrl+this.diff.imageA)):void(this.initializeCalculateMismatch||(this.imageAClass="is-loading",this.imageBClass="is-loading",this.canvasClass="is-loading",this.initializeCalculateMismatch=!0,null!=this.diff.imageA&&f(this.diff.imageA,this.diff.jsonpUrlA,function(t){e.imageASrc=t,e.imageAClass="has-loaded",e.isImageALoaded=!0}),null!=this.diff.imageB&&f(this.diff.imageB,this.diff.jsonpUrlB,function(t){e.imageBSrc=t,e.imageBClass="has-loaded",e.isImageBLoaded=!0})))},e.prototype.compareImages=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return e=this.diff,this.isImageALoaded&&this.isImageBLoaded&&!this.hasCalculatedMismatch?(this.hasCalculatedMismatch=!0,t=e,[4,function(e,t,i,r,a){var n=document.createElement("canvas");n.width=r,n.height=a;var c=document.createElement("canvas");c.width=r,c.height=a;var d=n.getContext("2d");d.drawImage(e,0,0);var f=c.getContext("2d");f.drawImage(t,0,0);var m=document.createElement("canvas").getContext("2d");m.drawImage(e,0,0),m.getImageData(0,0,r,a);var p=d.getImageData(0,0,r,a).data,g=f.getImageData(0,0,r,a).data,v=i.getContext("2d"),b=v.createImageData(r,n.height),y=function(e,t,i,r,a,n){n||(n={});for(var c=void 0===n.threshold?.1:n.threshold,d=35215*c*c,f=0,m=0;m<a;m++)for(var p=0;p<r;p++){var g=4*(m*r+p);if(s(e,t,g,g)>d)n.includeAA||!l(e,p,m,r,a,t)&&!l(t,p,m,r,a,e)?(i&&h(i,g,255,0,0),f++):i&&h(i,g,255,255,0);else if(i){var v=u(o(u((b=e)[(y=g)+0],w=b[y+3]/255),u(b[y+1],w),u(b[y+2],w)),.1);h(i,g,v,v,v)}}var b,y,w;return f}(p,g,b.data,r,a,{threshold:.1});return v.putImageData(b,0,0),y}(this.imageA,this.imageB,this.canvas,Math.round(e.width*e.deviceScaleFactor),Math.round(e.height*e.deviceScaleFactor))]):[2];case 1:return t.mismatchedPixels=i.sent(),this.canvasClass="has-loaded",r=e.mismatchedPixels,a=n(e.imageA,e.imageB),localStorage.setItem(a,String(r)),this.compareLoaded.emit(),[2]}var r,a})})},e.prototype.render=function(){var e=this,i=this.diff,r={width:i.width+"px",height:i.height+"px"};return[t("compare-cell",null,t("img",{src:this.imageASrc,class:this.imageAClass,style:r,onLoad:this.diff.identical?null:this.compareImages.bind(this),ref:function(t){return e.imageA=t}})),t("compare-cell",null,t("img",{src:this.imageBSrc,class:this.imageBClass,style:r,onLoad:this.diff.identical?null:this.compareImages.bind(this),ref:function(t){return e.imageB=t}})),t("compare-cell",null,this.diff.identical?t("img",{style:r,src:this.imageASrc}):t("canvas",{width:Math.round(i.width*i.deviceScaleFactor),height:Math.round(i.height*i.deviceScaleFactor),class:this.canvasClass,style:r,ref:function(t){return e.canvas=t}})),t("compare-cell",null,t("compare-analysis",{diff:this.diff}))]},Object.defineProperty(e,"is",{get:function(){return"compare-row"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{canvasClass:{state:!0},diff:{type:"Any",attr:"diff"},elm:{elementRef:!0},hidden:{type:Boolean,attr:"hidden",reflectToAttr:!0},imageAClass:{state:!0},imageASrc:{state:!0},imageBClass:{state:!0},imageBSrc:{state:!0},imagesUrl:{type:String,attr:"images-url"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"events",{get:function(){return[{name:"compareLoaded",method:"compareLoaded",bubbles:!0,cancelable:!0,composed:!0}]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return"compare-row canvas,compare-row img{-webkit-box-shadow:var(--screenshot-box-shadow);box-shadow:var(--screenshot-box-shadow);border-radius:var(--screenshot-border-radius)}.is-loading{visibility:hidden}"},enumerable:!0,configurable:!0}),e}(),v=function(){function e(){}return e.prototype.render=function(){var e=0;this.a.screenshots.forEach(function(t){t.width>e&&(e=t.width)});var i={width:(e+=8)+"px"};return[t("th-cell",null,t("div",{style:i},this.a.message)),t("th-cell",null,t("div",{style:i},this.b.message)),t("th-cell",null,t("div",{style:i},"Diff")),t("th-cell",{class:"analysis"},t("div",null,"Analysis"))]},Object.defineProperty(e,"is",{get:function(){return"compare-thead"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"encapsulation",{get:function(){return"shadow"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{a:{type:"Any",attr:"a"},b:{type:"Any",attr:"b"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"style",{get:function(){return":host{display:-webkit-box;display:-ms-flexbox;display:flex}th-cell{display:block;-webkit-box-flex:1;-ms-flex:1;flex:1;font-weight:500;font-size:12px}th-cell div{padding-left:12px}.analysis div{width:262px}"},enumerable:!0,configurable:!0}),e}();var b=function(){function e(){this.diffs=[]}return e.prototype.componentWillLoad=function(){var e,t,i,r,a,l;this.filter=(e={},""!==(t=location.hash.replace("#",""))&&t.split(";").forEach(function(t){var i=t.split("-");e[i[0]]=!(i.length>1)||i[1]}),e),this.diffs=(i=this.b,r=this.imagesUrl,a=this.jsonpUrl,l=this.a.screenshots.map(function(e){return{id:e.id,desc:e.desc,testPath:e.testPath,imageA:e.image,imageUrlA:""+r+e.image,jsonpUrlA:a+"screenshot_"+e.image+".js",imageB:null,imageUrlB:null,jsonpUrlB:null,imageDiff:null,identical:!1,mismatchedPixels:null,width:e.width,height:e.height,deviceScaleFactor:e.deviceScaleFactor,device:e.device||e.userAgent,hidden:!0}}),i.screenshots.forEach(function(e){var t=l.find(function(t){return t.id===e.id});t?(t.imageB=e.image,t.imageUrlB=""+r+e.image,t.jsonpUrlB=a+"screenshot_"+e.image+".js"):l.push(t={id:e.id,desc:e.desc,testPath:e.testPath,imageA:null,imageUrlA:null,jsonpUrlA:null,imageB:e.image,imageUrlB:""+r+e.image,jsonpUrlB:a+"screenshot_"+e.image+".js",imageDiff:null,identical:!1,mismatchedPixels:null,width:e.width,height:e.height,deviceScaleFactor:e.deviceScaleFactor,device:e.device||e.userAgent,hidden:!0})}),l.forEach(function(e){if(e.identical=e.imageUrlA===e.imageUrlB,e.identical)e.mismatchedPixels=0;else{var t=function(t,i){var r=n(e.imageA,e.imageB),a=localStorage.getItem(r);if("string"==typeof a){var l=parseInt(a,10);if(!isNaN(l))return l}return null}();"number"==typeof t&&(e.mismatchedPixels=t,0===e.mismatchedPixels&&(e.identical=!0))}}),l),this.updateDiffs()},e.prototype.filterChange=function(e){var t,i,r;this.filter=(t=Object.assign({},this.filter,e.detail),i=Object.keys(t),r=[],i.map(function(e){var i=t[e];!0===i?r.push(e):null!=i&&""!==i&&r.push(e+"-"+i)}),window.location.hash=r.sort().join(";"),t),this.updateDiffs()},e.prototype.compareLoaded=function(){this.updateDiffs()},e.prototype.updateDiffs=function(){var e;this.diffs=(e=this.filter,this.diffs.map(function(t){return t=Object.assign({},t),function(e,t){var i=!e.device||e.device===t.device,r=!e.search||t.desc.includes(e.search),a=!0;return e.mismatch?null!=t.mismatchedPixels&&"all"!==e.mismatch&&(a=parseInt(e.mismatch,10)<t.mismatchedPixels):a=t.mismatchedPixels>0||null==t.mismatchedPixels,t.hidden=!(i&&r&&a),t}(e,t)}).sort(function(e,t){return e.mismatchedPixels>t.mismatchedPixels?-1:e.mismatchedPixels<t.mismatchedPixels?1:e.desc.toLowerCase()<t.desc.toLowerCase()?-1:e.desc.toLowerCase()>t.desc.toLowerCase()?1:e.device.toLowerCase()<t.device.toLowerCase()?-1:e.device.toLowerCase()>t.device.toLowerCase()?1:0}))},e.prototype.render=function(){var e=this;return[t("compare-header",{diffs:this.diffs,filter:this.filter,appSrcUrl:this.appSrcUrl}),t("section",{class:"scroll-x"},t("compare-thead",{a:this.a,b:this.b}),t("section",{class:"scroll-y"},t("compare-table",null,t("compare-tbody",null,this.diffs.map(function(i){return t("compare-row",{key:i.id,id:"d-"+i.id,hidden:i.hidden,imagesUrl:e.imagesUrl,diff:i})})))))]},Object.defineProperty(e,"is",{get:function(){return"screenshot-compare"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"properties",{get:function(){return{a:{type:"Any",attr:"a"},appSrcUrl:{type:String,attr:"app-src-url"},b:{type:"Any",attr:"b"},buildIdA:{type:String,attr:"build-id-a"},buildIdB:{type:String,attr:"build-id-b"},filter:{state:!0},imagesUrl:{type:String,attr:"images-url"},jsonpUrl:{type:String,attr:"jsonp-url"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"listeners",{get:function(){return[{name:"filterChange",method:"filterChange"},{name:"compareLoaded",method:"compareLoaded"}]},enumerable:!0,configurable:!0}),e}();e.CompareAnalysis=i,e.CompareFilter=r,e.CompareHeader=a,e.CompareRow=g,e.CompareThead=v,e.ScreenshotCompare=b,Object.defineProperty(e,"__esModule",{value:!0})});